---
title: MATLAB并行计算中parfor的使用
author: xinyu
date: 2024-03-26 09:46:32 +0800
mermaid: true
categories: [学习记录]
tags: [MATLAB]
---

## 前言

MATLAB并行化计算功能通常使用Parallel Computing Toolbox工具箱实现，当我们使用多核处理器/GPU/计算集群时可以利用该工具箱实现并行计算，以充分利用资源。
在这里仅阐述对于多核CPU的并行化计算功能，并行化计算功能只能对于`for`循环结构使用，且有一定限制。当我们使用多核CPU时，通常的MATLAB程序将只会调度其中一个核，
可以使用`parfor`替换程序中的`for`循环结构来实现并行化。

示例程序如下，两种写法均可以，其中`M`表示给当前`parfor`分配的线程数，若不指定则默认分配当前最大线程数。
```MATLAB
% Example 1
parfor loopvar = initval:endval
    statements;
end
% Example 2
parfor (loopvar = initval:endval, M)
    statements;
end
```

### 使用并行计算parfor指令的前提

首先需要明确一点并不是任何程序使用`parfor`指令都能够带来处理增益，也并不是所有程序都可以使用`parfor`指令。

什么情况下使用`parfor`指令可以给程序带来增益。

1. for循环中的计算量很大

使用`parfor`指令的限制

1. 对于loopvar的要求
在`parfor`中，循环变量`loopvar`必须是**连续**的、**递增**的**正整数**，其它形式都是不被允许的，如`loopvar = 0:0.1:1`此类。
2. 对于statements的要求
对于循环中的结构必须是每次独立的，即第i次循环的结果与任意一次其它循环的结果都应无关，其中i为第任意次循环的下标。
3. `parfor`指令外围最好不要有其它的循环

## parfor 详解

在`parfor`结构中有以下几种变量。

|Loop Variables | Loop indices|
|Sliced Variables | Arrays whose segments are operated on by different iterations of the loop|
|Broadcast Variables|Variables defined before the loop whose value is required inside the loop, but never assigned inside the loop|
|Reduction Variables|Variables that accumulates a value across iterations of the loop, regardless of iteration order|
|Temporary Variables||



## 其它

设备一：
|CPU||
|内存||
|操作系统||
|MATLAB版本||